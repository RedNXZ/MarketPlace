<!DOCTYPE html>
<html>
<head>
  <title>EcommerceStore</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= javascript_importmap_tags %>
</head>

<body class="bg-gray-100 text-gray-800 font-sans min-h-screen flex flex-col">
<!-- üî∑ Header -->
<header class="bg-white shadow-sm border-b border-gray-200">
  <div class="container mx-auto px-4 py-4 flex justify-between items-center">
    <!-- –õ–æ–≥–æ—Ç–∏–ø -->
    <div class="text-2xl font-bold text-indigo-600">
      <%= link_to "EcommerceStore", root_path, class: "hover:text-indigo-700 transition" %>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="text-sm space-x-4 text-right">
      <% if user_signed_in? %>
            <span class="text-gray-700 font-medium">
              –ü—Ä–∏–≤–µ—Ç, <%= current_user.name || current_user.email %>
            </span>
        <%= link_to '–ö–æ—Ä–∑–∏–Ω–∞', cart_path, class: "text-indigo-600 hover:underline" %>
        <%= link_to '–ú–æ–∏ –∑–∞–∫–∞–∑—ã', orders_path, class: "text-indigo-600 hover:underline" %>
        <a href="#" id="logout-link" class="text-red-500 hover:underline">–í—ã–π—Ç–∏</a>
      <% else %>
        <%= link_to '–í–æ–π—Ç–∏', new_user_session_path, class: "text-indigo-600 hover:underline" %>
        <%= link_to '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è', new_user_registration_path, class: "text-indigo-600 hover:underline" %>
      <% end %>
    </div>
  </div>
</header>

<!-- üî∂ Main Content -->
<main class="flex-grow container mx-auto px-4 py-8">
  <%= yield %>
</main>

<!-- üîπ Footer -->
<footer class="bg-white text-center border-t border-gray-200 text-sm text-gray-500 py-4">
  &copy; <%= Time.current.year %> EcommerceStore. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
</footer>

<% if user_signed_in? %>
  <script>
      document.getElementById('logout-link')?.addEventListener('click', function(e) {
          e.preventDefault();
          fetch("<%= destroy_user_session_path %>", {
              method: 'DELETE',
              headers: {
                  'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content,
                  'Accept': 'application/json'
              },
              credentials: 'same-origin'
          }).then(() => {
              window.location.href = "/";
          });
      });
  </script>
<% end %>
</body>
</html>
