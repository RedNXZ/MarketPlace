<!DOCTYPE html>
<html>
<head>
  <title>EcommerceStore</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= javascript_importmap_tags %>
</head>

<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">
<!-- üîπ –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
<header class="bg-white border-b border-gray-200 shadow-sm p-4">
  <div class="container mx-auto flex justify-between items-center">
    <div class="text-xl font-bold text-blue-600">EcommerceStore</div>

    <div class="space-x-4 text-sm">
      <% if user_signed_in? %>
        <span>–ü—Ä–∏–≤–µ—Ç, <%= current_user.name || current_user.email %>!</span>
        <%= link_to '–ö–æ—Ä–∑–∏–Ω–∞', cart_path, class: "text-blue-500 hover:underline" %>
        <%= link_to '–ú–æ–∏ –∑–∞–∫–∞–∑—ã', orders_path, class: "text-blue-500 hover:underline" %>
        <a href="#" id="logout-link" class="text-red-500 hover:underline">–í—ã–π—Ç–∏</a>
      <% else %>
        <%= link_to '–í–æ–π—Ç–∏', new_user_session_path, class: "text-blue-500 hover:underline" %>
        <%= link_to '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è', new_user_registration_path, class: "text-blue-500 hover:underline" %>
      <% end %>
    </div>
  </div>
</header>

<!-- üîπ –ö–æ–Ω—Ç–µ–Ω—Ç -->
<main class="container mx-auto px-4 py-6 flex-grow">
  <%= yield %>
</main>

<!-- üîπ –§—É—Ç–µ—Ä -->
<footer class="bg-white border-t border-gray-200 p-4 text-center text-sm text-gray-500">
  &copy; <%= Time.current.year %> EcommerceStore. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
</footer>

<% if user_signed_in? %>
  <script>
      document.getElementById('logout-link').addEventListener('click', function(e) {
          e.preventDefault();

          fetch("<%= destroy_user_session_path %>", {
              method: 'DELETE',
              headers: {
                  'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content,
                  'Accept': 'application/json'
              },
              credentials: 'same-origin'
          }).then(() => {
              window.location.href = "/";
          });
      });
  </script>
<% end %>
</body>
</html>
